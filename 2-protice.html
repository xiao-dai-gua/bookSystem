<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <script src="./babel.min.js"></script>
    <script src="./react.development.js"></script>
    <script src="./react-dom.development.js"></script>
    <style>
        .active{
            background-color: pink;
        }
    </style>
</head>
<body>
    <div id="app"></div>
    <script type="text/babel">
    //每次用这个模板都把类写上
    class Main extends React.Component{
        constructor(){
            super();
            this.state={
                text:1,
                listdata:[
                    {
                    id:1,
                    name:"吃饭",
                    //注意不要加双引号
                    isShow:false
                },
                {
                    id:2,
                    name:"睡觉",
                    isShow:false
                },
                {
                    id:3,
                    name:"敲代码",
                    isShow:true
                }],
                showlist:[
                {
                    id:1,
                    name:"吃饭",
                    isShow:false
                },
                {
                    id:2,
                    name:"睡觉",
                    isShow:false
                },
                {
                    id:3,
                    name:"敲代码",
                    isShow:true
                }
                ]
            }

            this.dellist = this.dellist.bind(this);
            this.searchtext = this.searchtext.bind(this);
        }
        //增加数值
        add(data){
            let addlist = [...this.state.listdata];
            addlist.push({
                //利用此个函数用来定义不同的id，但是在前面刚开始设置数值的时候却不可以同一个时间加载会让加载的结果一样
                id:new Date().getTime(),
                name:data,
                isShow:false
            });
            this.setState({
                listdata:addlist,
                showlist:addlist,
            })
        }
        //删除数值
        dellist(id){
            let list1 = [...this.state.listdata];
             list1 =  this.state.listdata.filter(obj=>{
                 //找到不用删除的然后将
                return obj.id !== id
            })
            //当你发现值没有被改变的时候要绝对是两边的值不一样然后赋值没有成功了
            //你个憨憨真的是不想说话了整一个下午我真的是醉了
            this.setState({

                listdata:list1,
                showlist:list1,
            })
        }
        //改变原来的这个值
        changestatus(id){
            //此处注意传的是id号
            let listdata = [...this.state.listdata];
           listdata.map((value)=>{
               if(value.id == id){
                   value.isShow =!value.isShow;
               }
           })
            this.setState({
                listdata,
                showlist:listdata
            })

        }
        searchtext(text){
            console.log(this.state.listdata)
            let list = this.state.listdata.filter((value)=>{
                //返回只要包含这个值的所有数组元素 模糊搜索
                return value.name.includes(text)
            })
            //在此处设置一个特定用的搜索的值而不改变原来的值因为只是搜索
            this.setState({
                showlist:list
            })
        }
        render(){
            return(
                <div>
                    <h1>To Data List</h1>
                    <Search searchtext = {this.searchtext}/>
                    <Add add={this.add.bind(this)}/>
                    <List listdata={this.state.showlist} changestatus={this.changestatus.bind(this)} delFun ={this.dellist}/>
                </div>
            )
        }
    }
    class Search extends React.Component{
        constructor(){
            super();
           
            this.searchall = this.searchall.bind(this)
            //可以用这个方法直接引用ref属性
            this.myInput = React.createRef();
        }
        
        searchall(){
            console.log(this.myInput.current.value)
            this.props.searchtext(this.myInput.current.value);
        }
        render(){
            return(
                <div>
                    <input  ref={this.myInput} type="text"onKeyUp={this.searchall}/>
                </div>
            )
        }
    }
    class Add extends React.Component{
        constructor(){
            super();
            this.addlist = this.addlist.bind(this)
        }
        addlist(){
            let data = this.refs.myadd.value
            this.props.add(data);
            this.refs.myadd.value=""
            
        }
        render(){
            return(
                <div>
                    <input ref="myadd"/>
                    <button onClick = {this.addlist}>添加</button>
                </div>
            )
        }
    }
    class List extends React.Component{
        constructor(){
            super();
            this.state = {
            }
        }
        deldata(id){
            this.props.delFun(id);
        }
        status(id){
            this.props.changestatus(id);
        }
        //key一定要加在外层因为每加载一次就重新创建一次唯一标识
        render(){
            return(
                this.props.listdata.map((value,index)=>{
                       return (<ul key={value.id}>
                        <li className={value.isShow ? "active":""}>
                                    <input type="checkbox" defaultChecked={value.isShow} onClick = {this.status.bind(this,value.id)}/>{value.name}
                                    <button onClick={this.deldata.bind(this,value.id)}>删除</button>
                                </li>
                        </ul>)
                    })
                )

                   
        }
    }


    ReactDOM.render(<Main />,document.getElementById("app"));
    </script>
    
</body>
</html>